<div class="container">
  <div class="row" style="min-height: 500px !important">
    <!-- <div class="col-sm-3">
      <mat-card class="card-padrao" style="min-height: 500px !important">
        <div class="row">
          <div class="col-sm-12">
            <h5><b>PERSONAGENS </b></h5>
            <hr />
          </div>
        </div>
      </mat-card>
    </div> -->
    <div class="col-sm-12">
      <mat-card class="card-padrao" style="min-height: 500px !important">
        <div class="row">
          <div class="col-sm-2">
            <div class="row">
              <div class="d-flex justify-content-center">
                <img src="assets/img/icon_sheet.png" alt="Avatar" class="rounded-circle imagem-ficha" width="50"
                  height="50" />
              </div>
            </div>
            <div class="row">
              <div class="col-sm-12 mt-1 d-flex justify-content-center">
                <b>{{ "PONTOS: " + personagem.pontos }}</b>
              </div>
            </div>
          </div>

          <div class="col-sm-10">
            <div class="row">
              <div class="col-sm-2">
                <h5 class="mt-2"><b>JOGADOR: </b></h5>
              </div>
              <div class="col-sm-4">
                <input class="col-sm-4 m-1 vida-mana-defesa" size="1" [value]="" style="width: 100% !important;" />
              </div>
              <div class="col-sm-3 d-flex">
                <button class="btn btn-sm btn-outline-secondary ms-2 botao-ficha" (click)="openDialog('RAÇA', 1)">
                  <!-- <img *ngIf="personagem.raca" [src]="personagem.raca.imagem" [alt]="personagem.raca.nome" style="width: 100px !important; height: 100px !important;" /> -->
                  <b style="color: white !important">{{
                    personagem.raca
                    ? personagem.raca?.nome?.toLocaleUpperCase()
                    : "RAÇA:"
                    }}</b>
                </button>
              </div>
              <div class="col-sm-3 d-flex">
                <button class="btn btn-sm btn-outline-secondary ms-2 botao-ficha" (click)="openDialog('ORIGEM', 5)">
                  <b style="color: white !important">ORIGEM:</b>
                </button>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-2">
                <h5 class="mt-2"><b>PERSONAGEM: </b></h5>
              </div>
              <div class="col-sm-4">
                <input class="col-sm-4 m-1 vida-mana-defesa" size="1" [value]="" style="width: 100% !important;" />
              </div>
              <div class="col-sm-3 d-flex">
                <button class="btn btn-sm btn-outline-secondary ms-2 botao-ficha" (click)="openDialog('DEUS', 7)">
                  <b style="color: white !important">DIVINDADE:</b>
                </button>
              </div>
              <div class="col-sm-3 d-flex">
                <div class="row">
                  <div class="col-sm-4">
                    <h5 class="mt-2"><b>NÍVEL: </b></h5>
                  </div>
                  <div class="col-sm-2 mt-1 mr-0">
                    <button (click)="personagem.diminuirNivel()" [disabled]="personagem.nivel === 1"
                      class="vida-mana-defesa">-</button>
                  </div>
                  <div class="col-sm-4 p-0">
                    <input class="col-sm-4 m-1 vida-mana-defesa" size="2" [value]="personagem.nivel"
                      style="width: 100% !important;" />
                  </div>
                  <div class="col-sm-2 mt-1 ml-0">
                    <button (click)="personagem.aumentarNivel()" [disabled]="personagem.nivel === 20"
                      class="vida-mana-defesa">+</button>
                  </div>

                </div>
              </div>
            </div>
            <div class="row ">
              <div class="col-sm-2 d-flex">
                <h5 class="mt-2"><b>CLASSES: </b></h5>
              </div>
              <div class="col-sm-9 d-flex">
                <input class="col-sm-4 m-1 vida-mana-defesa" size="1" [value]="" style="width: 100% !important;"
                  disabled />
              </div>
              <div class="col-sm-1 d-flex">
                <button class="btn btn-sm botao-ficha" (click)="openDialog('CLASSE', 6)">
                  <b style="color: white !important">+</b>
                </button>
              </div>
            </div>
          </div>



        </div>
        <div class="row">
          <div class="col-sm-12">
            <hr />
          </div>
        </div>
        <div class="row">
          <div class="col-sm-8">
            <div class="row">
              <div class="col-sm-12">
                <mat-card class="card-padrao">
                  <div class="row align-items-center">
                    <div class="col-sm-2">
                      <div class="row">
                        <div class="col-sm-12 text-justify">
                          <b style="font-size: x-large !important">FOR</b>
                          <img src="assets/img/d20.png" class="img-dado"
                            style="margin-bottom: 15px !important;margin-left: 10px !important" />
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="col-sm-3">
                          <div class="row">
                            <div class="col-sm-12">
                              <div>
                                <button class="botoes-mais-menos" [disabled]="
                                    personagem.atributos.forca_comprada === 4
                                  " (click)="
                                    personagem.calculaPontos(
                                      'for',
                                      personagem.atributos.forca_comprada + 1
                                    )
                                  ">
                                  +
                                </button>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-sm-12">
                              <button class="botoes-mais-menos" [disabled]="
                                  personagem.atributos.forca_comprada === -1
                                " (click)="
                                  personagem.calculaPontos(
                                    'for',
                                    personagem.atributos.forca_comprada - 1
                                  )
                                ">
                                -
                              </button>
                            </div>
                          </div>
                        </div>
                        <div class="col-sm-9" style="padding-left: 2% !important;">
                          <input class="campo-modificadores" size="1" [value]="personagem.atributos.forca" disabled />
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="d-flex">
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.forca_comprada" disabled />
                          <input class="campo-atributos" value="0" size="1" [value]="personagem.atributos.forca_racial"
                            disabled />
                          <input class="campo-atributos" value="0" size="1" [value]="personagem.atributos.forca_bonus"
                            disabled />
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-2">
                      <div class="row">
                        <div class="col-sm-12 text-justify">
                          <b style="font-size: x-large !important">DES</b>
                          <img src="assets/img/d20.png" class="img-dado"
                            style="margin-bottom: 15px !important;margin-left: 10px !important" />
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="col-sm-3">
                          <div class="row">
                            <div class="col-sm-12">
                              <div>
                                <button class="botoes-mais-menos" [disabled]="
                                    personagem.atributos.destreza_comprada === 4
                                  " (click)="
                                    personagem.calculaPontos(
                                      'des',
                                      personagem.atributos.destreza_comprada + 1
                                    )
                                  ">
                                  +
                                </button>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-sm-12">
                              <button class="botoes-mais-menos" [disabled]="
                                  personagem.atributos.destreza_comprada === -1
                                " (click)="
                                  personagem.calculaPontos(
                                    'des',
                                    personagem.atributos.destreza_comprada - 1
                                  )
                                ">
                                -
                              </button>
                            </div>
                          </div>
                        </div>
                        <div class="col-sm-9" style="padding-left: 2% !important;">
                          <input class="campo-modificadores" size="1" [value]="personagem.atributos.destreza"
                            disabled />
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="d-flex">
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.destreza_comprada" disabled />
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.destreza_racial" disabled />
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.destreza_bonus" disabled />
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-2">
                      <div class="row">
                        <div class="col-sm-12 text-justify">
                          <b style="font-size: x-large !important">CON</b>
                          <img src="assets/img/d20.png" class="img-dado"
                            style="margin-bottom: 15px !important;margin-left: 10px !important" />
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="col-sm-3">
                          <div class="row">
                            <div class="col-sm-12">
                              <div>
                                <button class="botoes-mais-menos" [disabled]="
                                    personagem.atributos
                                      .constituicao_comprada === 4
                                  " (click)="
                                    personagem.calculaPontos(
                                      'con',
                                      personagem.atributos
                                        .constituicao_comprada + 1
                                    )
                                  ">
                                  +
                                </button>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-sm-12">
                              <button class="botoes-mais-menos" [disabled]="
                                  personagem.atributos.constituicao_comprada ===
                                  -1
                                " (click)="
                                  personagem.calculaPontos(
                                    'con',
                                    personagem.atributos.constituicao_comprada -
                                      1
                                  )
                                ">
                                -
                              </button>
                            </div>
                          </div>
                        </div>
                        <div class="col-sm-9" style="padding-left: 2% !important;">
                          <input class="campo-modificadores" size="1" [value]="personagem.atributos.constituicao"
                            disabled />
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="d-flex">
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.constituicao_comprada" disabled />
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.constituicao_racial" disabled />
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.constituicao_bonus" disabled />
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-2">
                      <div class="row">
                        <div class="col-sm-12 text-justify">
                          <b style="font-size: x-large !important">INT</b>
                          <img src="assets/img/d20.png" class="img-dado"
                            style="margin-bottom: 15px !important;margin-left: 10px !important" />
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="col-sm-3">
                          <div class="row">
                            <div class="col-sm-12">
                              <div>
                                <button class="botoes-mais-menos" [disabled]="
                                    personagem.atributos
                                      .inteligencia_comprada === 4
                                  " (click)="
                                    personagem.calculaPontos(
                                      'int',
                                      personagem.atributos
                                        .inteligencia_comprada + 1
                                    )
                                  ">
                                  +
                                </button>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-sm-12">
                              <button class="botoes-mais-menos" [disabled]="
                                  personagem.atributos.inteligencia_comprada ===
                                  -1
                                " (click)="
                                  personagem.calculaPontos(
                                    'int',
                                    personagem.atributos.inteligencia_comprada -
                                      1
                                  )
                                ">
                                -
                              </button>
                            </div>
                          </div>
                        </div>
                        <div class="col-sm-9" style="padding-left: 2% !important;">
                          <input class="campo-modificadores" size="1" [value]="personagem.atributos.inteligencia"
                            disabled />
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="d-flex">
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.inteligencia_comprada" disabled />
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.inteligencia_racial" disabled />
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.inteligencia_bonus" disabled />
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-2">
                      <div class="row">
                        <div class="col-sm-12 text-justify">
                          <b style="font-size: x-large !important">SAB</b>
                          <img src="assets/img/d20.png" class="img-dado"
                            style="margin-bottom: 15px !important;margin-left: 10px !important" />
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="col-sm-3">
                          <div class="row">
                            <div class="col-sm-12">
                              <div>
                                <button class="botoes-mais-menos" [disabled]="
                                    personagem.atributos.sabedoria_comprada ===
                                    4
                                  " (click)="
                                    personagem.calculaPontos(
                                      'sab',
                                      personagem.atributos.sabedoria_comprada +
                                        1
                                    )
                                  ">
                                  +
                                </button>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-sm-12">
                              <button class="botoes-mais-menos" [disabled]="
                                  personagem.atributos.sabedoria_comprada === -1
                                " (click)="
                                  personagem.calculaPontos(
                                    'sab',
                                    personagem.atributos.sabedoria_comprada - 1
                                  )
                                ">
                                -
                              </button>
                            </div>
                          </div>
                        </div>
                        <div class="col-sm-9" style="padding-left: 2% !important;">
                          <input class="campo-modificadores" size="1" [value]="personagem.atributos.sabedoria"
                            disabled />
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="d-flex">
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.sabedoria_comprada" disabled />
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.sabedoria_racial" disabled />
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.sabedoria_bonus" disabled />
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-2">
                      <div class="row">
                        <div class="col-sm-12 text-justify">
                          <b style="font-size: x-large !important">CAR</b>
                          <img src="assets/img/d20.png" class="img-dado"
                            style="margin-bottom: 15px !important;margin-left: 10px !important" />
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="col-sm-3">
                          <div class="row">
                            <div class="col-sm-12">
                              <div>
                                <button class="botoes-mais-menos" [disabled]="
                                    personagem.atributos.carisma_comprada === 4
                                  " (click)="
                                    personagem.calculaPontos(
                                      'car',
                                      personagem.atributos.carisma_comprada + 1
                                    )
                                  ">
                                  +
                                </button>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-sm-12">
                              <button class="botoes-mais-menos" [disabled]="
                                  personagem.atributos.carisma_comprada === -1
                                " (click)="
                                  personagem.calculaPontos(
                                    'car',
                                    personagem.atributos.carisma_comprada - 1
                                  )
                                ">
                                -
                              </button>
                            </div>
                          </div>
                        </div>
                        <div class="col-sm-9" style="padding-left: 2% !important;">
                          <input class="campo-modificadores" size="1" [value]="personagem.atributos.carisma" disabled />
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="d-flex">
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.carisma_comprada" disabled />
                          <input class="campo-atributos" value="0" size="1"
                            [value]="personagem.atributos.carisma_racial" disabled />
                          <input class="campo-atributos" style="text-align: center !important" value="0" size="1"
                            [value]="personagem.atributos.carisma_bonus" disabled />
                        </div>
                      </div>
                    </div>
                  </div>
                </mat-card>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-4">
                <mat-card class="card-padrao">
                  <b style="text-align: center">PONTOS DE VIDA</b>
                  <hr />
                  <div class="row">
                    <div style="text-align: center" class="col-sm-4">ATUAL</div>
                    <div style="text-align: center" class="col-sm-4">TOTAL</div>
                    <div style="text-align: center" class="col-sm-4">TEMP.</div>
                  </div>
                  <div class="row">
                    <input class="col-sm-4 m-1 vida-mana-defesa" value="0" size="1"
                      [value]="personagem.pontos_vida_atual" />
                    <div class="col-sm-3 m-1 vida-mana-defesa">
                      {{ personagem.pontos_vida_total }}
                    </div>
                    <div class="col-sm-3 m-1 vida-mana-defesa">
                      {{ personagem.pontos_vida_temporarios }}
                    </div>
                  </div>
                </mat-card>
              </div>
              <div class="col-sm-4">
                <mat-card class="card-padrao">
                  <b style="text-align: center">PONTOS DE MANA</b>
                  <hr />
                  <div class="row">
                    <div style="text-align: center" class="col-sm-4">ATUAL</div>
                    <div style="text-align: center" class="col-sm-4">TOTAL</div>
                    <div style="text-align: center" class="col-sm-4">TEMP.</div>
                  </div>
                  <div class="row">
                    <input class="col-sm-4 m-1 vida-mana-defesa" value="0" size="1"
                      [value]="personagem.pontos_mana_atual" />
                    <div class="col-sm-3 m-1 vida-mana-defesa">
                      {{ personagem.pontos_mana_total }}
                    </div>
                    <div class="col-sm-3 m-1 vida-mana-defesa">
                      {{ personagem.pontos_mana_temporarios }}
                    </div>
                  </div>
                </mat-card>
              </div>
              <div class="col-sm-4">
                <mat-card class="card-padrao">
                  <b style="text-align: center">DEFESA</b>
                  <hr />
                  <div class="row">
                    <div class="col-sm-11 m-1 vida-mana-defesa" style="margin-left: 10px !important">
                      {{ personagem.defesa.defesa }}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-6 mt-1 d-flex">
                      <select class="vida-mana-defesa" style="font-size: 12pt !important" [value]="personagem.defesa.atributo_defesa">
                        @for (atributo of atributos; track atributo) {
                        <option [selected]="
                            personagem.recuperaValor(atributo.toString()) ===
                            personagem.recuperaValor('Destreza')
                          " [value]="atributo">
                          {{ atributo }}
                        </option>
                        }
                      </select>
                    </div>
                    <div class="col-sm-6 mt-1 d-flex">
                      <button class="btn btn-sm botao-ficha" style="padding: 0px !important; vertical-align: middle !important;height: 100% !important;" (click)="showDialog()">
                        <b style="color: white !important">
                        {{personagem.defesa.bonus_total}}
                        </b>
                      </button>
                      <div class="card flex justify-center">
                        <p-dialog header="Bônus Defesa" [modal]="true" [(visible)]="visible" [style]="{ width: '25rem' }">
                          <div class="container">
                            @for (bonus of personagem.defesa.defesa_bonus; track bonus) {
                              <div class="row">
                                <div class="col-sm-7">
                                  <label>{{bonus.descricao}}</label>
                                </div>
                                <div class="col-sm-1">
                                  <input class="vida-mana-defesa" [value]="bonus.bonus" disabled/>
                                </div>
                                <div class="col-sm-4">
                                  <label>{{bonus.duracao}}</label>
                                </div>
                              </div>  
                            }
                            @if (personagem.defesa.defesa_bonus.length === 0) {
                              <div class="col-sm-12">
                                <label>O personagem não possui bônus extras.</label>
                              </div>
                            }
                          </div>
                          <div class="button-row mt-4 d-flex justify-content-end">
                            <button class="me-2" (click)="visible = false" mat-flat-button>
                              Concluir
                            </button>
                            <!-- <button mat-flat-button>Adicionar Raça</button> -->
                          </div>
                        </p-dialog>
                    </div>
                    </div>
                  </div>
                </mat-card>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-8">
                <div class="row">
                  <div class="col-sm-12">
                    <mat-card class="card-padrao">
                      <mat-expansion-panel [expanded]="true" [disabled]="true">
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <div class="container">
                              <div class="row">
                                <div class="col-sm-10">
                                  <b> EQUIPAMENTOS EMPUNHADOS </b>
                                </div>
                                <div class="col-sm-2 d-flex justify-content-end">
                                  <span class="material-symbols-outlined"
                                    (click)="openDialog('ITENS: EQUIPAMENTOS EMPUNHADOS', 2)">
                                    <mat-icon>shopping_cart</mat-icon>
                                  </span>
                                </div>
                              </div>
                            </div>
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <hr />
                        <div class="row">
                          <table mat-table [dataSource]="personagem.posse!.equipamentos_empunhados ?? []"
                            multiTemplateDataRows class="mat-elevation-z8 full-width">
                            @for (column of displayedColumnsEmpunhados; track column) {
                            <ng-container matColumnDef="{{ column }}" class="mat-column-treinado">
                              <th class="pericia" mat-header-cell *matHeaderCellDef
                                style="text-transform: uppercase; padding-left: 2% !important">
                                {{ column }}
                              </th>
                              <td style="padding-left: 2% !important" class="pericia" mat-cell
                                *matCellDef="let element">{{ element[column] }}</td>
                            </ng-container>
                            }
                            <ng-container matColumnDef="expand">
                              <th mat-header-cell *matHeaderCellDef aria-label="row actions" class="pericia"
                                style="padding-left: 2% !important">
                                &nbsp;
                              </th>
                              <td style="padding-left: 2% !important" class="pericia" mat-cell
                                *matCellDef="let element">
                                <img src="assets/img/d20.png" class="img-dado" (click)="element.rolarDado()"
                                  style="margin-bottom: 0px !important; vertical-align: super;" />
                                <button mat-icon-button aria-label="expand row" (click)="
                                    expandedElementEmpunhados = expandedElementEmpunhados === element ? null : element;
                                    $event.stopPropagation()
                                  ">
                                  @if (expandedElementEmpunhados === element) {
                                  <mat-icon>keyboard_arrow_up</mat-icon>
                                  } @else {
                                  <mat-icon>keyboard_arrow_down</mat-icon>
                                  }
                                </button>
                              </td>
                            </ng-container>
                            <ng-container matColumnDef="expandedDetail">
                              <td style="padding-left: 2% !important" class="pericia" mat-cell *matCellDef="let element"
                                [attr.colspan]="displayedColumnsWithExpandEmpunhados.length">
                                <div class="container celement-detail" [@detailExpand]="
                                    element == expandedElementEmpunhados ? 'expanded' : 'collapsed'
                                  ">
                                  <mat-tab-group>
                                    <mat-tab label="Descrição">
                                      <div class="text-justify" [innerHTML]="element.descricao">
                                      </div>
                                    </mat-tab>
                                    <mat-tab label="Detalhes">
                                      <div class="container">
                                        <div class="row">
                                          <div class="col-sm-6 mt-2">
                                            <label>Proficiência:</label>
                                          </div>
                                          <div class="col-sm-6 mt-2">
                                            <input style="font-size: 12pt !important; width: 100%;"
                                              class="col-sm-3 vida-mana-defesa" size="2" change=""
                                              [(ngModel)]="element.ataque.proficiencia" disabled />
                                          </div>
                                        </div>
                                        <div class="row">
                                          <div class="col-sm-6 mt-2">
                                            <label>Distância:</label>
                                          </div>
                                          <div class="col-sm-6 mt-2">
                                            <input style="font-size: 12pt !important; width: 100%;"
                                              class="col-sm-3 vida-mana-defesa" size="2" change=""
                                              [(ngModel)]="element.ataque.distancia" disabled />
                                          </div>
                                        </div>
                                        <div class="row">
                                          <div class="col-sm-6 mt-2">
                                            <label>Empunhadura:</label>
                                          </div>
                                          <div class="col-sm-6 mt-2">
                                            <input style="font-size: 12pt !important; width: 100%;"
                                              class="col-sm-3 vida-mana-defesa" size="2" change=""
                                              [(ngModel)]="element.ataque.empunhadura" disabled />
                                          </div>
                                        </div>
                                        <div class="row">
                                          <div class="col-sm-6 mt-2">
                                            <label>Alcance:</label>
                                          </div>
                                          <div class="col-sm-3 mt-2">
                                            <input style="font-size: 12pt !important; width: 100%;"
                                              class="col-sm-3 vida-mana-defesa" size="2" change=""
                                              [(ngModel)]="element.ataque.alcance" disabled />
                                          </div>
                                          <div class="col-sm-3 mt-2">
                                            <label>metros</label>
                                          </div>
                                        </div>
                                        <div class="row">
                                          <hr>
                                        </div>
                                        <mat-expansion-panel (opened)="panelOpenState.set(true)" *ngIf="element.ataque"
                                          (closed)="panelOpenState.set(false)">
                                          <mat-expansion-panel-header
                                            style="padding-top: 0px !important; margin-top: 0px !important;">
                                            <mat-panel-title>
                                              <div class="container">
                                                <div class="row">
                                                  <div class="col-sm-2 mt-2">
                                                    <label>Ataque:</label>
                                                  </div>
                                                  <div class="col-sm-2 mt-2">
                                                    <input style="font-size: 12pt !important; width: 100%;"
                                                      class="col-sm-3 vida-mana-defesa" size="2" change=""
                                                      [(ngModel)]="element.ataque.ataque" disabled />
                                                  </div>
                                                  <div class="col-sm-4 mt-2">
                                                    <mat-select *ngIf="element.ataque" class="vida-mana-defesa"
                                                      style="font-size: 12pt !important" selectionChange=""
                                                      [(value)]="element.ataque.pericia_descricao_ataque">
                                                      @for (pericia of personagem.pericias; track pericia.pericia) {
                                                      <mat-option [value]="pericia.pericia">
                                                        {{ pericia.pericia }}
                                                      </mat-option>
                                                      }
                                                    </mat-select>
                                                  </div>
                                                  <div class="col-sm-4 mt-2">
                                                    <mat-select *ngIf="element.ataque" class="vida-mana-defesa"
                                                      style="font-size: 12pt !important" selectionChange=""
                                                      [(value)]="element.ataque.atributo_descricao_ataque">
                                                      @for (atributo of atributos; track atributo) {
                                                      <mat-option [value]="atributo">
                                                        {{atributo}}
                                                      </mat-option>
                                                      }
                                                    </mat-select>
                                                  </div>
                                                </div>
                                              </div>
                                            </mat-panel-title>
                                          </mat-expansion-panel-header>
                                          <div class="row">
                                            <hr>
                                          </div>
                                          <div class="container">
                                            <div class="row">
                                              <div class="col-sm-6 mt-2">
                                                <label>{{element.ataque.pericia_descricao_ataque}}</label>
                                              </div>
                                              <div class="col-sm-6 mt-2">
                                                <input style="font-size: 12pt !important; width: 100%;"
                                                  class="col-sm-3 vida-mana-defesa" size="2" change=""
                                                  [value]="element.getBonusPericiaAtaque(personagem)" disabled />
                                              </div>
                                            </div>
                                            <div class="row">
                                              <div class="col-sm-6 mt-2">
                                                <label>{{element.ataque.atributo_descricao_ataque}}</label>
                                              </div>
                                              <div class="col-sm-6 mt-2">
                                                <input style="font-size: 12pt !important; width: 100%;"
                                                  class="col-sm-3 vida-mana-defesa" size="2" change=""
                                                  [value]="element.getBonusAtributoAtaque(personagem)" disabled />
                                              </div>
                                            </div>
                                            @for (bonus of element.ataque.bonus_ataque; track bonus) {
                                            <div class="row">
                                              <div class="col-sm-12 mt-2">
                                                <label>{{bonus.origem}}</label>
                                              </div>
                                              <hr>
                                            </div>
                                            <div class="row">
                                              <div class="col-sm-2 mt-2">
                                                <label>Bônus</label>
                                              </div>
                                              <div class="col-sm-2 mt-2">
                                                <input style="font-size: 12pt !important; width: 100%;"
                                                  class="col-sm-3 vida-mana-defesa" size="2" change=""
                                                  [(ngModel)]="bonus.bonus" disabled />
                                              </div>
                                              <div class="col-sm-6 mt-2">
                                                <label>{{bonus.condicao}}</label>
                                              </div>
                                              <div class="col-sm-2 mt-2">
                                                <mat-checkbox name="treinado" style="margin: 1px !important;"
                                                  [(ngModel)]="bonus.ativo" change="">
                                                </mat-checkbox>
                                              </div>
                                            </div>
                                            }
                                          </div>

                                        </mat-expansion-panel>
                                        <mat-expansion-panel (opened)="panelOpenState.set(true)" *ngIf="element.ataque"
                                          (closed)="panelOpenState.set(false)" class="mt-2">
                                          <mat-expansion-panel-header
                                            style="padding-top: 0px !important; margin-top: 0px !important;">
                                            <mat-panel-title>
                                              <div class="container">
                                                <div class="row">
                                                  <div class="col-sm-2 mt-2">
                                                    <label>Dano:</label>
                                                  </div>
                                                  <div class="col-sm-5 mt-2">
                                                    <input style="font-size: 12pt !important; width: 100%;"
                                                      class="col-sm-3 vida-mana-defesa" size="2" change=""
                                                      [(ngModel)]="element.ataque.dano" disabled />
                                                  </div>
                                                  <div class="col-sm-5 mt-2">
                                                    <mat-select *ngIf="element.ataque" class="vida-mana-defesa"
                                                      style="font-size: 12pt !important" selectionChange=""
                                                      [(value)]="element.ataque.atributo_descricao_ataque">
                                                      @for (atributo of atributos; track atributo) {
                                                      <mat-option [value]="atributo">
                                                        {{atributo}}
                                                      </mat-option>
                                                      }
                                                    </mat-select>
                                                  </div>
                                                </div>
                                              </div>
                                            </mat-panel-title>
                                          </mat-expansion-panel-header>
                                          <div class="row">
                                            <hr>
                                          </div>
                                          DESCRIÇÃO DETALHADA

                                        </mat-expansion-panel>
                                        <mat-expansion-panel (opened)="panelOpenState.set(true)" *ngIf="element.ataque"
                                          (closed)="panelOpenState.set(false)" class="mt-2">
                                          <mat-expansion-panel-header
                                            style="padding-top: 0px !important; margin-top: 0px !important;">
                                            <mat-panel-title>
                                              <div class="container">
                                                <div class="row">
                                                  <div class="col-sm-7 mt-2">
                                                    <label>Margem de Ameaça:</label>
                                                  </div>
                                                  <div class="col-sm-5 mt-2">
                                                    <input style="font-size: 12pt !important; width: 100%;"
                                                      class="col-sm-3 vida-mana-defesa" size="2" change=""
                                                      [(ngModel)]="element.ataque.margem_ameaca" disabled />
                                                  </div>
                                                </div>
                                              </div>
                                            </mat-panel-title>
                                          </mat-expansion-panel-header>
                                          <div class="row">
                                            <hr>
                                          </div>
                                          DESCRIÇÃO DETALHADA

                                        </mat-expansion-panel>
                                        <mat-expansion-panel (opened)="panelOpenState.set(true)" *ngIf="element.ataque"
                                          (closed)="panelOpenState.set(false)" class="mt-2">
                                          <mat-expansion-panel-header
                                            style="padding-top: 0px !important; margin-top: 0px !important;">
                                            <mat-panel-title>
                                              <div class="container">
                                                <div class="row">
                                                  <div class="col-sm-7 mt-2">
                                                    <label>Multiplicador de Crítico:</label>
                                                  </div>
                                                  <div class="col-sm-5 mt-2">
                                                    <input style="font-size: 12pt !important; width: 100%;"
                                                      class="col-sm-3 vida-mana-defesa" size="2" change=""
                                                      [(ngModel)]="element.ataque.multiplicador_critico" disabled />
                                                  </div>
                                                </div>
                                              </div>
                                            </mat-panel-title>
                                          </mat-expansion-panel-header>
                                          <div class="row">
                                            <hr>
                                          </div>
                                          DESCRIÇÃO DETALHADA

                                        </mat-expansion-panel>
                                      </div>
                                    </mat-tab>
                                  </mat-tab-group>
                                </div>
                              </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumnsWithExpandEmpunhados"></tr>
                            <tr mat-row *matRowDef="let element; columns: displayedColumnsWithExpandEmpunhados"
                              class="element-row" [class.expanded-row]="expandedElementEmpunhados === element"></tr>
                            <tr mat-row *matRowDef="let row; columns: ['expandedDetail'];" class="detail-row"></tr>
                          </table>
                        </div>
                      </mat-expansion-panel>
                    </mat-card>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-12">
                    <mat-card class="card-padrao">
                      <mat-expansion-panel [expanded]="true" [disabled]="true">
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <div class="container">
                              <div class="row">
                                <div class="col-sm-10">
                                  <b> EQUIPAMENTOS VESTIDOS </b>
                                </div>
                                <div class="col-sm-2 d-flex justify-content-end">
                                  <span class="material-symbols-outlined"
                                    (click)="openDialog('ITENS: EQUIPAMENTOS VESTIDOS', 2)">
                                    <mat-icon>shopping_cart</mat-icon>
                                  </span>
                                </div>
                              </div>
                            </div>
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <hr />
                        <div class="row">
                          <table mat-table [dataSource]="personagem.posse!.equipamentos_vestidos ?? []"
                            multiTemplateDataRows class="mat-elevation-z8">
                            <ng-container matColumnDef="equipamento" class="mat-column-treinado">
                              <th style="padding-left: 2% !important" class="pericia" mat-header-cell *matHeaderCellDef
                                mat-sort-header>
                                EQUIPAMENTO
                              </th>
                              <td style="padding-left: 2% !important" class="pericia" mat-cell
                                *matCellDef="let element">
                                {{ element.nome?.toUpperCase() }}
                              </td>
                            </ng-container>
                            <ng-container matColumnDef="formula" class="mat-column-treinado">
                              <th style="padding-left: 2% !important" class="pericia" mat-header-cell *matHeaderCellDef
                                mat-sort-header>
                                FORMULA
                              </th>
                              <td style="padding-left: 2% !important" class="pericia" mat-cell
                                *matCellDef="let element">
                                {{ element.formula }}
                              </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="
                                displayedColumnsVestido
                              "></tr>
                            <tr mat-row *matRowDef="
                                let row;
                                columns: displayedColumnsVestido
                              "></tr>
                          </table>
                        </div>
                      </mat-expansion-panel>
                    </mat-card>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-12">
                    <mat-card class="card-padrao">
                      <mat-expansion-panel [expanded]="true" [disabled]="true">
                        <mat-expansion-panel-header style="padding-left: 8px !important">
                          <mat-panel-title>
                            <div class="container">
                              <div class="row">
                                <div class="col-sm-10">
                                  <b> EQUIPAMENTOS CARREGADOS </b>
                                </div>
                                <div class="col-sm-2 d-flex justify-content-end">
                                  <span class="material-symbols-outlined"
                                    (click)="openDialog('ITENS: EQUIPAMENTOS CARREGADOS', 2)">
                                    <mat-icon>shopping_cart</mat-icon>
                                  </span>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-sm-12">
                                  <hr>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-sm-6">
                                  {{ "LIMITE DE CARGA: "+ personagem.posse!.carga_atual + " / " +
                                  (personagem.posse!.total_carga!*2)
                                  }}
                                  <section class="example-section">
                                    <mat-progress-bar class="example-margin" mode="determinate"
                                      [value]="(personagem.posse!.carga_atual! / (personagem.posse!.total_carga!*2)) * 100">
                                    </mat-progress-bar>
                                  </section>
                                </div>
                                <div class="col-sm-3 d-flex justify-content-end">
                                  <div *ngIf="personagem.posse!.carga_atual! > personagem.posse!.total_carga!">
                                    SOBRECARREGADO
                                  </div>
                                </div>
                                <div class="col-sm-3 d-flex justify-content-end">
                                  <select class="vida-mana-defesa" style="font-size: 12pt !important">
                                    @for (atributo of atributos; track atributo)
                                    {
                                    <option [selected]="
                                        personagem.recuperaValor(
                                          atributo.toString()
                                        ) === personagem.recuperaValor('Força')
                                      " [value]="atributo">
                                      {{ atributo }}
                                    </option>
                                    }
                                  </select>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-sm-12">
                                  <hr>
                                </div>
                              </div>
                              <div class="row">

                                <div class="col-sm-2">
                                  <span class="material-symbols-outlined">
                                    <mat-icon>savings</mat-icon>
                                  </span>
                                </div>
                                <div class="col-sm-10">
                                  <div class="row">

                                    <div class="col-sm-3">
                                      TP$:
                                      <input type="text" [(ngModel)]="personagem.posse!.moedas_plantina" size="4"
                                        class="campo-atributos input-numerico" />
                                    </div>
                                    <div class="col-sm-3">
                                      TO$:
                                      <input type="text" [(ngModel)]="personagem.posse!.moedas_ouro" size="4"
                                        class="campo-atributos input-numerico" />
                                    </div>
                                    <div class="col-sm-3">
                                      T$:
                                      <input type="text" [(ngModel)]="personagem.posse!.moedas_prata" size="4"
                                        class="campo-atributos input-numerico" />
                                    </div>
                                    <div class="col-sm-3">
                                      TC$:
                                      <input type="text" [(ngModel)]="personagem.posse!.moedas_cobre" size="4"
                                        class="campo-atributos input-numerico" />
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <hr />
                        <div class="row">
                          <table mat-table [dataSource]="personagem.posse!.equipamentos_carregados ?? []"
                            multiTemplateDataRows class="mat-elevation-z8">
                            <ng-container matColumnDef="equipamento" class="mat-column-treinado">
                              <th style="padding-left: 2% !important" class="pericia" mat-header-cell *matHeaderCellDef
                                mat-sort-header>
                                EQUIPAMENTO
                              </th>
                              <td style="padding-left: 2% !important" class="pericia" mat-cell
                                *matCellDef="let element">
                                {{ element.nome?.toUpperCase() }}
                              </td>
                            </ng-container>
                            <ng-container matColumnDef="quantidade" class="mat-column-treinado">
                              <th style="padding-left: 2% !important" class="pericia" mat-header-cell *matHeaderCellDef
                                mat-sort-header>
                                QUANTIDADE
                              </th>
                              <td style="padding-left: 2% !important" class="pericia" mat-cell
                                *matCellDef="let element">
                                {{ element.quantidade }}
                              </td>
                            </ng-container>
                            <ng-container matColumnDef="espaco" class="mat-column-treinado">
                              <th style="padding-left: 2% !important" class="pericia" mat-header-cell *matHeaderCellDef
                                mat-sort-header>
                                ESPACO
                              </th>
                              <td style="padding-left: 2% !important" class="pericia" mat-cell
                                *matCellDef="let element">
                                {{ element.espaco }}
                              </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="displayedColumnsCarregados"></tr>
                            <tr mat-row *matRowDef="
                                let row;
                                columns: displayedColumnsCarregados
                              "></tr>
                          </table>
                        </div>
                      </mat-expansion-panel>
                    </mat-card>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-12">
                    <mat-card class="card-padrao">
                      <mat-expansion-panel [expanded]="true" [disabled]="true">
                        <mat-expansion-panel-header>
                          <mat-panel-title>
                            <div class="container">
                              <div class="row">
                                <div class="col-sm-10">
                                  <b> OUTROS ITENS </b>
                                </div>
                                <div class="col-sm-2 d-flex justify-content-end">
                                  <span class="material-symbols-outlined"
                                    (click)="openDialog('ITENS: OUTROS ITENS', 2)">
                                    <mat-icon>shopping_cart</mat-icon>
                                  </span>
                                </div>
                              </div>
                            </div>
                          </mat-panel-title>
                        </mat-expansion-panel-header>
                        <hr />
                        <div class="row">
                          <table mat-table [dataSource]="personagem.posse!.itens  ?? []" multiTemplateDataRows
                            class="mat-elevation-z8">
                            <ng-container matColumnDef="item" class="mat-column-treinado">
                              <th style="padding-left: 2% !important" class="pericia" mat-header-cell *matHeaderCellDef
                                mat-sort-header>
                                ITEM
                              </th>
                              <td style="padding-left: 2% !important" class="pericia" mat-cell
                                *matCellDef="let element">
                                {{ element.nome?.toUpperCase() }}
                              </td>
                            </ng-container>
                            <ng-container matColumnDef="descricao" class="mat-column-treinado">
                              <th style="padding-left: 2% !important" class="pericia" mat-header-cell *matHeaderCellDef
                                mat-sort-header>
                                DESCRIÇÃO
                              </th>
                              <td style="padding-left: 2% !important" class="pericia" mat-cell
                                *matCellDef="let element">
                                {{ element.descricao }}
                              </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="displayedColumnsItens"></tr>
                            <tr mat-row *matRowDef="
                                let row;
                                columns: displayedColumnsItens
                              "></tr>
                          </table>
                        </div>
                      </mat-expansion-panel>
                    </mat-card>
                  </div>
                </div>
              </div>
              <div class="col-sm-4">
                <div class="row">
                  <mat-card class="card-padrao">
                    <mat-expansion-panel [expanded]="true" [disabled]="true">
                      <mat-expansion-panel-header>
                        <mat-panel-title>
                          <b> PROFICIÊNCIAS </b>
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <hr />
                      @for (proficiencia of personagem.proficiencia; track
                      proficiencia) {
                      <div class="row">
                        <button class="me-2 proficiencia" mat-flat-button disabled>
                          {{ proficiencia }}
                        </button>
                      </div>
                      }
                    </mat-expansion-panel>
                  </mat-card>
                </div>
                <div class="row">
                  <mat-card class="card-padrao">
                    <mat-expansion-panel [expanded]="true" [disabled]="true">
                      <mat-expansion-panel-header>
                        <mat-panel-title>
                          <b> TAMANHO </b>
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <hr />
                      <select class="vida-mana-defesa" style="
                          font-size: 12pt !important;
                          width: 100% !important;
                        ">
                        @for (tamanho of tamanhos; track tamanho) {
                        <option [selected]="
                            personagem.recuperaValor(tamanho.toString()) ===
                            personagem.recuperaValor('Médio')
                          " [value]="tamanho">
                          {{ tamanho }}
                        </option>
                        }
                      </select>
                    </mat-expansion-panel>
                  </mat-card>
                </div>
                <div class="row">
                  <mat-card class="card-padrao">
                    <mat-expansion-panel [expanded]="true" [disabled]="true">
                      <mat-expansion-panel-header>
                        <mat-panel-title>
                          <b> DESLOCAMENTOS </b>
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <hr />
                      @for (deslocamento of personagem.deslocamentos; track
                      deslocamento){
                      <div class="row">
                        <button class="me-2 proficiencia" mat-flat-button disabled>
                          {{
                          deslocamento.nome +
                          " " +
                          deslocamento.valor +
                          " metros"
                          }}
                        </button>
                      </div>
                      }
                    </mat-expansion-panel>
                  </mat-card>
                </div>
                <div class="row">
                  <mat-card class="card-padrao">
                    <mat-expansion-panel [expanded]="true" [disabled]="true">
                      <mat-expansion-panel-header>
                        <mat-panel-title>
                          <b> SENTIDOS </b>
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <hr />
                      @for (sentidos of personagem.sentidos; track sentidos){
                      <div class="row">
                        <button class="me-2 proficiencia" mat-flat-button disabled>
                          {{ sentidos }}
                        </button>
                      </div>
                      }
                    </mat-expansion-panel>
                  </mat-card>
                </div>
                <div class="row">
                  <mat-card class="card-padrao">
                    <mat-expansion-panel [expanded]="true" [disabled]="true">
                      <mat-expansion-panel-header>
                        <mat-panel-title>
                          <b> RESISTÊNCIAS </b>
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <hr />
                      @for (rd of personagem.resistencias; track rd){
                      <div class="row">
                        <button class="me-2 proficiencia" mat-flat-button disabled>
                          {{ rd.fonte + " " + rd.redutor }}
                        </button>
                      </div>
                      }
                    </mat-expansion-panel>
                  </mat-card>
                </div>
                <div class="row">
                  <mat-card class="card-padrao">
                    <mat-expansion-panel [expanded]="true" [disabled]="true">
                      <mat-expansion-panel-header>
                        <mat-panel-title>
                          <b> IMUNIDADES </b>
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <hr />
                      @for (imunidade of personagem.imunidades; track
                      imunidade){
                      <div class="row">
                        <button class="me-2 proficiencia" mat-flat-button disabled>
                          {{ imunidade.nome }}
                        </button>
                      </div>
                      }
                    </mat-expansion-panel>
                  </mat-card>
                </div>
              </div>
              <div class="row" style="width: 104% !important; max-width: 104%">
                <div class="col-sm-12" style="padding-right: 0% !important">
                  <mat-card class="card-padrao">
                    <mat-expansion-panel [expanded]="true" [disabled]="true">
                      <mat-expansion-panel-header>
                        <mat-panel-title>
                          <div class="container">
                            <div class="row">
                              <div class="col-sm-10">
                                <b> HABILIDADES E PODERES </b>
                              </div>
                              <div class="col-sm-2 d-flex justify-content-end">
                                <span class="material-symbols-outlined" (click)="openDialog('PODERES', 4)">
                                  swords
                                </span>
                              </div>
                            </div>
                          </div>
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <hr />
                      <div class="row">
                        <div class="col-sm-12 mt-2">
                         
                          <table mat-table [dataSource]="dataSourcePoderesPersonagens" multiTemplateDataRows
                          class="mat-elevation-z8 full-width">
                          @for (column of displayedColumnsPoderes; track column) {
                          <ng-container matColumnDef="{{ column }}" class="mat-column-treinado">
                            <th class="pericia" mat-header-cell *matHeaderCellDef
                              style="text-transform: uppercase; padding-left: 2% !important">
                              {{ column }}
                            </th>
                            <td style="padding-left: 2% !important" class="pericia" mat-cell *matCellDef="let element">
                              {{ element.poder[column] }}</td>
                          </ng-container>
                          }
                          <ng-container matColumnDef="expand">
                            <th mat-header-cell *matHeaderCellDef aria-label="row actions" class="pericia"
                              style="padding-left: 2% !important">
                              &nbsp;
                            </th>
                            <td style="padding-left: 2% !important" class="pericia" mat-cell *matCellDef="let element">
                              <img src="assets/img/d20.png" class="img-dado" (click)="element.rolarDado()"
                                style="margin-bottom: 0px !important; vertical-align: super;" />
                              <button mat-icon-button aria-label="expand row" (click)="
                                    expandedElementPoderes = expandedElementPoderes === element ? null : element;
                                    $event.stopPropagation()
                                  ">
                                @if (expandedElementPoderes === element) {
                                <mat-icon>keyboard_arrow_up</mat-icon>
                                } @else {
                                <mat-icon>keyboard_arrow_down</mat-icon>
                                }
                              </button>
                            </td>
                          </ng-container>
                          <ng-container matColumnDef="expandedDetail">
                            <td style="padding-left: 2% !important" class="pericia" mat-cell *matCellDef="let element"
                              [attr.colspan]="displayedColumnsWithExpandPoderes.length">
                              <div class="container celement-detail" [@detailExpand]="
                                    element == expandedElementPoderes ? 'expanded' : 'collapsed'
                                  ">
                                <mat-tab-group>
                                  <mat-tab label="Descrição">
                                    <div class="text-justify mt-2 mb-2" [innerHTML]="element.poder.descricao">
                                    </div>
                                  </mat-tab>
                                </mat-tab-group>
                              </div>
                            </td>
                          </ng-container>

                          <tr mat-header-row *matHeaderRowDef="displayedColumnsWithExpandPoderes"></tr>
                          <tr mat-row *matRowDef="let element; columns: displayedColumnsWithExpandPoderes"
                            class="element-row" [class.expanded-row]="expandedElementPoderes === element"></tr>
                          <tr mat-row *matRowDef="let row; columns: ['expandedDetail'];" class="detail-row"></tr>
                        </table>



                        </div>
                      </div>
                    </mat-expansion-panel>
                  </mat-card>
                </div>
              </div>
              <div class="row" style="width: 104% !important; max-width: 104%">
                <div class="col-sm-12" style="padding-right: 0% !important">
                  <mat-card class="card-padrao">
                    <mat-expansion-panel [expanded]="true" [disabled]="true">
                      <mat-expansion-panel-header>
                        <mat-panel-title>
                          <div class="container">
                            <div class="row">
                              <div class="col-sm-10">
                                <b> MAGIAS </b>
                              </div>
                              <div class="col-sm-2 d-flex justify-content-end">
                                <span class="material-symbols-outlined" (click)="openDialog('MAGIAS', 3)">
                                  <mat-icon>thunderstorm</mat-icon>
                                </span>
                              </div>

                            </div>
                          </div>
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <hr />
                      <div class="row">
                        <table mat-table [dataSource]="dataSourceMagiasPersonagens" multiTemplateDataRows
                          class="mat-elevation-z8 full-width">
                          @for (column of displayedColumnsMagias; track column) {
                          <ng-container matColumnDef="{{ column }}" class="mat-column-treinado">
                            <th class="pericia" mat-header-cell *matHeaderCellDef
                              style="text-transform: uppercase; padding-left: 2% !important">
                              {{ column }}
                            </th>
                            <td style="padding-left: 2% !important" class="pericia" mat-cell *matCellDef="let element">
                              {{ element.magia[column] }}</td>
                          </ng-container>
                          }
                          <ng-container matColumnDef="expand">
                            <th mat-header-cell *matHeaderCellDef aria-label="row actions" class="pericia"
                              style="padding-left: 2% !important">
                              &nbsp;
                            </th>
                            <td style="padding-left: 2% !important" class="pericia" mat-cell *matCellDef="let element">
                              <img src="assets/img/d20.png" class="img-dado" (click)="element.rolarDado()"
                                style="margin-bottom: 0px !important; vertical-align: super;" />
                              <button mat-icon-button aria-label="expand row" (click)="
                                    expandedElementMagia = expandedElementMagia === element ? null : element;
                                    $event.stopPropagation()
                                  ">
                                @if (expandedElementMagia === element) {
                                <mat-icon>keyboard_arrow_up</mat-icon>
                                } @else {
                                <mat-icon>keyboard_arrow_down</mat-icon>
                                }
                              </button>
                            </td>
                          </ng-container>
                          <ng-container matColumnDef="expandedDetail">
                            <td style="padding-left: 2% !important" class="pericia" mat-cell *matCellDef="let element"
                              [attr.colspan]="displayedColumnsWithExpandMagias.length">
                              <div class="container celement-detail" [@detailExpand]="
                                    element == expandedElementMagia ? 'expanded' : 'collapsed'
                                  ">
                                <mat-tab-group>
                                  <mat-tab label="Descrição">
                                    <div class="text-justify mt-2 mb-2" [innerHTML]="element.magia.descricao">
                                    </div>
                                  </mat-tab>
                                  <mat-tab label="Aprimoramento">
                                  </mat-tab>
                                </mat-tab-group>
                              </div>
                            </td>
                          </ng-container>

                          <tr mat-header-row *matHeaderRowDef="displayedColumnsWithExpandMagias"></tr>
                          <tr mat-row *matRowDef="let element; columns: displayedColumnsWithExpandMagias"
                            class="element-row" [class.expanded-row]="expandedElementMagia === element"></tr>
                          <tr mat-row *matRowDef="let row; columns: ['expandedDetail'];" class="detail-row"></tr>
                        </table>
                      </div>
                    </mat-expansion-panel>
                  </mat-card>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-4">
            <mat-card class="card-padrao">
              <div class="row">
                <div class="row">
                  <div class="col-sm-12">
                    <b>Número de Perícias Livres: </b>
                    <input type="text" [(ngModel)]="personagem.numero_pericias_livre" size="2"
                      style="text-align: center !important" class="campo-atributos input-numerico" disabled />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-12 mt-2">
                  <table mat-table [dataSource]="dsPericias" multiTemplateDataRows class="mat-elevation-z8 full-width">
                    @for (column of columnsToDisplayPericia; track column) {
                    <ng-container matColumnDef="{{ column }}" class="mat-column-treinado">
                      <th class="pericia" mat-header-cell *matHeaderCellDef
                        style="text-transform: uppercase; padding-left: 2% !important">
                        {{ column }}
                      </th>
                      <td style="padding-left: 2% !important"
                        [class]="element[column].length > 2 ? 'pericia':'pericia-valor'" mat-cell
                        *matCellDef="let element">{{ element[column] }}</td>
                    </ng-container>
                    }
                    <ng-container matColumnDef="expand">
                      <th mat-header-cell *matHeaderCellDef aria-label="row actions" class="pericia"
                        style="padding-left: 2% !important">
                        &nbsp;
                      </th>
                      <td style="padding-left: 2% !important" class="pericia" mat-cell *matCellDef="let element">
                        <img src="assets/img/d20.png" class="img-dado" (click)="element.rolarDado()" />
                        <button mat-icon-button aria-label="expand row" (click)="
                          expandedElementPericia = expandedElementPericia === element ? null : element;
                          $event.stopPropagation()
                        ">
                          @if (expandedElementPericia === element) {
                          <mat-icon>keyboard_arrow_up</mat-icon>
                          } @else {
                          <mat-icon>keyboard_arrow_down</mat-icon>
                          }
                        </button>
                      </td>
                    </ng-container>
                    <ng-container matColumnDef="expandedDetail">
                      <td style="padding-left: 2% !important" class="pericia" mat-cell *matCellDef="let element"
                        [attr.colspan]="columnsToDisplayWithExpandPericia.length">
                        <div class="container celement-detail" [@detailExpand]="
                          element == expandedElementPericia ? 'expanded' : 'collapsed'
                        ">
                          <mat-tab-group>
                            <mat-tab label="Detalhes">
                              <div class="container">
                                <div class="row" style="line-height: 250% !important;">
                                  <div class="col-sm-12">
                                    <label>Treinado:</label>
                                    <mat-checkbox [disabled]="seDesabilitaCheck(element)" name="treinado"
                                      style="margin: 1px !important;"
                                      (change)="element.checkTreinamento($event.checked, personagem)">
                                    </mat-checkbox>
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-sm-12">
                                    <hr style="margin: 5px !important;" />
                                  </div>
                                </div>
                                <div class="row" style="line-height: 250% !important;">
                                  <div class="col-sm-5">
                                    <label>Treinamento:</label>
                                  </div>
                                  <div class="col-sm-1">
                                    {{ element.treinado ? personagem.nivel! >= 7 ? 4 : personagem.nivel! >= 15 ? 6: 2 :
                                    0}}
                                  </div>
                                </div>
                                <div class="row" style="line-height: 250% !important;">
                                  <div class="col-sm-5">
                                    Nível:
                                  </div>
                                  <div class="col-sm-1">
                                    {{ element.getBonusNivel() }}
                                  </div>
                                </div>
                                <div class="row" style="line-height: 250% !important;">
                                  <div class="col-sm-5">
                                    Atributo:
                                  </div>
                                  <div class="col-sm-1">
                                    {{ element.atributo }}
                                  </div>
                                  <div class="col-sm-6">
                                    <mat-select class="vida-mana-defesa" style="font-size: 12pt 
                                !important"
                                      (selectionChange)="element.recalculaPericia(personagem.recuperaValorAtributo($event.value))"
                                      [(value)]="element.atributo_selecionado_descricao">
                                      @for (atributo of atributos; track atributo) {
                                      <mat-option [value]="atributo">
                                        {{ atributo }}
                                      </mat-option>
                                      }
                                    </mat-select>
                                  </div>
                                </div>
                                @for (bonus of element.bonus_condicional_permanente; track bonus) {
                                <div class="row" style="line-height: 250% !important;">
                                  <div class="col-sm-5">
                                    Bônus de Poder:
                                  </div>
                                  <div class="col-sm-1">
                                    {{ bonus.bonus }}
                                  </div>
                                  <div class="col-sm-2">
                                    <mat-checkbox name="treinado" style="margin: 1px !important;"
                                      [(ngModel)]="element.ativo"
                                      (change)="element.ativaDesativaBonusCondicionalPermanente(bonus)">
                                    </mat-checkbox>
                                  </div>
                                  <div class="col-sm-4">
                                    {{ bonus.condicao.join(", ") }}
                                  </div>
                                </div>
                                }
                                <div class="row">
                                  <div class="col-sm-12">
                                    <hr style="margin: 5px !important;" />
                                  </div>
                                </div>
                                <div class="row" style="line-height: 250% !important;">
                                  <div class="col-sm-5">
                                    Total:
                                  </div>
                                  <div class="col-sm-1">
                                    {{ element.total }}
                                  </div>
                                </div>
                              </div>
                            </mat-tab>
                            <mat-tab label="Descrição">
                              <div class="col-sm-12 mt-4 text-justify" [innerHTML]="element.descricao"></div>
                            </mat-tab>
                          </mat-tab-group>
                        </div>
                      </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpandPericia"></tr>
                    <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpandPericia" class="element-row"
                      [class.expanded-row]="expandedElementPericia === element"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['expandedDetail'];" class="detail-row"></tr>
                  </table>
                </div>
              </div>
            </mat-card>
          </div>
        </div>
      </mat-card>
    </div>
  </div>
</div>